<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Montealegre_Sofia_RecipeDiscover.Converters"
             x:Class="Montealegre_Sofia_RecipeDiscover.RecipeBrowserPage">

	<ContentPage.Resources>
		<ResourceDictionary>
			<converters:IsNotNullConverter x:Key="IsNotNullConverter" />
			<converters:IsNullConverter x:Key="IsNullConverter" />
			<converters:BoolToHeartConverter x:Key="BoolToHeartConverter" />
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid RowDefinitions="Auto,*">

		<!-- ðŸ” Search -->
		<VerticalStackLayout Grid.Row="0" Padding="10"
							 IsVisible="{Binding SelectedRecipe, Converter={StaticResource IsNullConverter}}">
			<Label Text="ðŸ“–Find a Recipe"
				   FontFamily="Default"
                   FontSize="30"
                   FontAttributes="Italic"
                   HorizontalOptions="Center"
                   Margin="0,10,0,5"/>

			<SearchBar Placeholder="Search recipes..."
					   FontFamily="Default"
                       Text="{Binding SearchText}"
                       SearchCommand="{Binding SearchCommand}" 
					   BackgroundColor="DarkSalmon"
					   TextColor="white"/>
		</VerticalStackLayout>

		<!-- ðŸ“ƒ Recipe List -->
		<CollectionView Grid.Row="1"
                        ItemsSource="{Binding Recipes}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedRecipe}"
                        Margin="5"
                        IsVisible="{Binding SelectedRecipe, Converter={StaticResource IsNullConverter}}">

			<CollectionView.ItemTemplate>
				<DataTemplate>
					<Grid Padding="10" ColumnDefinitions="80,*">
						<Border StrokeThickness="0"
                                StrokeShape="RoundRectangle 8"
                                HeightRequest="80"
                                WidthRequest="80">
							<Image Source="{Binding Image}"
                                   Aspect="AspectFill" />
						</Border>
						<VerticalStackLayout Grid.Column="1"
                                             Padding="10,0"
                                             VerticalOptions="Center">
							<Label Text="{Binding Name}"
                                   FontSize="16"
                                   FontAttributes="Bold" />

							<Label Text="{Binding Category}"
                                   FontSize="12"
                                   TextColor="Gray" />

							<Label Text="{Binding Tags}"
                                   FontSize="11"
                                   TextColor="Gray"
                                   LineBreakMode="TailTruncation"/>
						</VerticalStackLayout>
					</Grid>
				</DataTemplate>
			</CollectionView.ItemTemplate>
		</CollectionView>

		<!-- ðŸ“„ Recipe Details -->
		<Grid Grid.Row="1"
              IsVisible="{Binding SelectedRecipe, Converter={StaticResource IsNotNullConverter}}">
			<!-- Back -->
			<Button Text="â† Back"
					Command="{Binding ClearSelectionCommand}"
					HorizontalOptions="Start"
					VerticalOptions="Start"
					Margin="10"
					FontAttributes="Bold"
					FontSize="18"
					BackgroundColor="Transparent"
					TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
			<ScrollView Margin="0,50,0,0">
				
				<VerticalStackLayout BindingContext="{Binding SelectedRecipe}"
                                     Padding="10"
                                     Spacing="12">

					<!-- Image -->

					<Border StrokeThickness="0"
						StrokeShape="RoundRectangle 12"
						HeightRequest="220">
						<Image Source="{Binding Image}"
						   Aspect="AspectFill"/>		
					</Border>

					<!-- Title + Heart -->
					<Grid>
						<Label Text="{Binding Name}"
						   FontSize="26"
						   FontAttributes="Bold"/>

						<!-- â¤ï¸ Favorite Button -->
						<Button
							Text="{Binding IsFavorite, Converter={StaticResource BoolToHeartConverter}}"
							FontSize="30"
							BackgroundColor="Transparent"
							HorizontalOptions="End"
							Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleFavoriteCommand}"
							CommandParameter="{Binding .}" />
					</Grid>
					<Label Text="{Binding Category}"
                           FontSize="16"
                           TextColor="Gray"/>

					<!-- Ingredients -->
					<Label Text="Ingredients"
                           FontSize="20"
                           FontAttributes="Bold"
                           Margin="0,10,0,5"/>

					<CollectionView ItemsSource="{Binding ingredients}">
						<CollectionView.ItemTemplate>
							<DataTemplate>
								<Grid ColumnDefinitions="*,Auto"
                                      Padding="4">
									<Label Text="{Binding Name}" />
									<Label Text="{Binding Measure}"
                                           Grid.Column="1"
                                           TextColor="Gray"/>
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>

					<!-- Instructions -->
					<Label Text="Instructions"
                           FontSize="20"
                           FontAttributes="Bold"
                           Margin="0,10,0,5"/>

					<Label Text="{Binding Instructions}"
                           LineHeight="1.5"/>
				</VerticalStackLayout>
			</ScrollView>
		</Grid>

	</Grid>
</ContentPage>
