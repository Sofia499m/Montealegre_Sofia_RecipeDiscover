<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
			 xmlns:converters="clr-namespace:Montealegre_Sofia_RecipeDiscover.Converters"
             x:Class="Montealegre_Sofia_RecipeDiscover.RecipeBrowserPage"
             Title="">

	<ContentPage.Resources>
		<ResourceDictionary>
			<converters:IsNotNullConverter x:Key="IsNotNullConverter" />
			<converters:IsNullConverter x:Key="IsNullConverter" />
		</ResourceDictionary>
	</ContentPage.Resources>

	<Grid RowDefinitions="Auto,*">
		<VerticalStackLayout Grid.Row="0" Padding="10">
			<Label Text="Find a Recipe" 
		       FontSize="20" 
		       FontAttributes="Bold" 
		       HorizontalOptions="Center" 
		       Margin="0,10,0,5"/>
			<SearchBar 
		    Placeholder="Search recipes..."
		    Text="{Binding SearchText}"
		    SearchCommand="{Binding SearchCommand}"/>
		</VerticalStackLayout>

		<CollectionView Grid.Row="1"
	                ItemsSource="{Binding Recipes}"
	                SelectionMode="Single"
	                SelectedItem="{Binding SelectedRecipe}"
	                Margin="5"
	                IsVisible="{Binding SelectedRecipe, Converter={StaticResource IsNullConverter}}">
			<CollectionView.ItemTemplate>
				<DataTemplate>
					<Grid Padding="10" ColumnDefinitions="80,*" RowSpacing="5">
						<Border
							Grid.Column="0" 
							StrokeThickness="0"
							StrokeShape="RoundRectangle 8"
							HeightRequest="80" 
							WidthRequest="80">
							<Image Source="{Binding Image}" 
						       Aspect="AspectFill"
						       HeightRequest="80" 
						       WidthRequest="80"/>
						</Border>
						<VerticalStackLayout Grid.Column="1" 
					                     Padding="10,0" 
					                     VerticalOptions="Center">
							<Label Text="{Binding Name}" 
						       FontAttributes="Bold" 
						       FontSize="16"/>
							<Label Text="{Binding Category}" 
						       FontSize="12"
						       TextColor="Gray"
						       LineBreakMode="TailTruncation"/>
							<Label Text="{Binding Tags}" 
						       FontSize="11"
						       TextColor="Gray"
						       LineBreakMode="TailTruncation"/>
						</VerticalStackLayout>
					</Grid>
				</DataTemplate>
			</CollectionView.ItemTemplate>
		</CollectionView>

		<Grid Grid.Row="1" 
	      IsVisible="{Binding SelectedRecipe, Converter={StaticResource IsNotNullConverter}}">

			<Button Text="â† Back to List" 
		        Command="{Binding ClearSelectionCommand}"
		        HorizontalOptions="Start"
		        VerticalOptions="Start"
		        Margin="10"
		        BackgroundColor="Transparent"
		        TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}"/>

			<ScrollView Margin="0,50,0,0">
				<VerticalStackLayout BindingContext="{Binding SelectedRecipe}" 
			                     Padding="10">
					<Border 
						Padding="0" 
						StrokeShape="RoundRectangle 12"
						StrokeThickness="0"
						Margin="0,0,0,15"
						HeightRequest="200">
						<Image 
							Source="{Binding Image}"
							HeightRequest="200"
							Aspect="AspectFill"/>
					</Border>

					<Label Text="{Binding Name}"
				       FontAttributes="Bold" 
				       FontSize="24"
				       Margin="0,0,0,5"/>

					<Label Text="{Binding Category}" 
				       FontSize="16"
				       TextColor="Gray"
				       Margin="0,0,0,20"/>
					
					<Label Text="Ingredients" 
				       FontAttributes="Bold" 
				       FontSize="20"
				       Margin="0,10,0,10"/>

					<CollectionView ItemsSource="{Binding ingredients}">
						<CollectionView.ItemTemplate>
							<DataTemplate>
								<Grid ColumnDefinitions="*,Auto" 
							      Padding="5,8"
							      RowSpacing="0">
									<Label Text="{Binding Name}"
								       FontSize="14"
								       VerticalOptions="Center"/>
									<Label Text="{Binding Measure}"
								       Grid.Column="1"
								       FontSize="14"
								       TextColor="Gray"
								       VerticalOptions="Center"/>
								</Grid>
							</DataTemplate>
						</CollectionView.ItemTemplate>
					</CollectionView>

					<Label Text="Instructions"
				       FontAttributes="Bold"
				       FontSize="20"
				       Margin="0,20,0,10"/>

					<Label Text="{Binding Instructions}" 
				       FontSize="14"
				       LineHeight="1.5"
				       Margin="0,0,0,20"/>
				</VerticalStackLayout>
			</ScrollView>
		</Grid>
	</Grid>
</ContentPage>